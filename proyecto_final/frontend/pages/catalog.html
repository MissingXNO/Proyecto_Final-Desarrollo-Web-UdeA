<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo de Vehículos</title>
    <link href="../assets/css/styles.css" rel="stylesheet">
    <link rel="icon" href="../assets/images/favicon.png" type="image/png">
    
</head>
<body class="bg-black text-white flex flex-col w-full h-auto py-2">

    <!-- NavBar -->
    <div id="navbar-placeholder"></div>


    
<!-- Barra de Filtros -->
<div class="bg-gray-800 py-2 relative w-full">
    <div class="mx-auto max-w-7xl px-4 flex flex-wrap justify-center space-x-4 space-y-4 md:space-y-0 md:space-x-6 items-center w-full">
        <span class="text-gray-400 mb-2 md:mb-0">FILTROS:</span>

        <!-- Filtro de TRANSMISIÓN -->
        <div class="relative w-full md:w-auto">
            <button onclick="toggleMenu('transmision-menu')" class="text-white bg-gray-700 px-4 py-2 rounded hover:bg-gray-600 w-full md:w-auto">
                TRANSMISIÓN ↓
            </button>
            <div id="transmision-menu" class="dropdown-menu absolute bg-gray-900 text-gray-300 rounded shadow-lg mt-2 hidden w-full md:w-auto z-10">
                <label class="block px-4 py-2">
                    <input type="checkbox" class="filter-transmision" id="manual"> Manual
                </label>
                <label class="block px-4 py-2">
                    <input type="checkbox" class="filter-transmision" id="automática"> Automática
                </label>
            </div>
        </div>

        <!-- Filtro de DISPONIBILIDAD -->
        <div class="relative w-full md:w-auto">
            <button onclick="toggleMenu('disponibilidad-menu')" class="text-white bg-gray-700 px-4 py-2 rounded hover:bg-gray-600 w-full md:w-auto">
                DISPONIBILIDAD ↓
            </button>
            <div id="disponibilidad-menu" class="dropdown-menu absolute bg-gray-900 text-gray-300 rounded shadow-lg mt-2 hidden w-full md:w-auto z-10">
                <label class="block px-4 py-2">
                    <input type="checkbox" class="filter-disponibilidad" id="disponible"> Disponible
                </label>
                <label class="block px-4 py-2">
                    <input type="checkbox" class="filter-disponibilidad" id="proximamente"> Próximamente
                </label>
            </div>
        </div>

        <!-- Filtro de FABRICANTE -->
        <div class="relative w-full md:w-auto">
            <button onclick="toggleMenu('fabricante-menu')" class="text-white bg-gray-700 px-4 py-2 rounded hover:bg-gray-600 w-full md:w-auto">
                FABRICANTE ↓
            </button>
            <div id="fabricante-menu" class="dropdown-menu absolute bg-gray-900 text-gray-300 rounded shadow-lg mt-2 hidden w-full md:w-auto z-50">
                    <label class="block px-4 py-2">
                        <input type="checkbox" class="filter-fabricante" id="ford"> Ford
                    </label>
                    <label class="block px-4 py-2">
                        <input type="checkbox" class="filter-fabricante" id="toyota"> Toyota
                    </label>
                    <label class="block px-4 py-2">
                        <input type="checkbox" class="filter-fabricante" id="nissan"> Nissan
                    </label>
                    <label class="block px-4 py-2">
                        <input type="checkbox" class="filter-fabricante" id="chevrolet"> Chevrolet
                    </label>
                    <label class="block px-4 py-2">
                        <input type="checkbox" class="filter-fabricante" id="mazda"> Mazda
                    </label>
                    <label class="block px-4 py-2">
                        <input type="checkbox" class="filter-fabricante" id="porsche"> Porsche
                    </label>
                    <label class="block px-4 py-2">
                        <input type="checkbox" class="filter-fabricante" id="ferrari"> Ferrari
                    </label>
                    <label class="block px-4 py-2">
                        <input type="checkbox" class="filter-fabricante" id="jeep"> Jeep
                    </label>
                    <label class="block px-4 py-2">
                        <input type="checkbox" class="filter-fabricante" id="renault"> Renault
                    </label>
                </div>
            </div>
            <!-- Filtro de CATEGORÍA -->
            <div class="relative w-full md:w-auto">
                <button onclick="toggleMenu('categoria-menu')" class="text-white bg-gray-700 px-4 py-2 rounded hover:bg-gray-600 w-full md:w-auto">
                    CATEGORÍA ↓
                </button>
                <div id="categoria-menu" class="dropdown-menu absolute bg-gray-900 text-gray-300 rounded shadow-lg mt-2 hidden w-full md:w-auto z-50">
                    </label>
                    <label class="block px-4 py-2">
                        <input type="checkbox" class="filter-categoria" id="sedan"> Sedan
                    </label>
                    <label class="block px-4 py-2">
                        <input type="checkbox" class="filter-categoria" id="hatchback"> Hatchback
                    </label>
                    <label class="block px-4 py-2">
                        <input type="checkbox" class="filter-categoria" id="pickup"> Pickup
                    </label>
                    <label class="block px-4 py-2">
                        <input type="checkbox" class="filter-categoria" id="coupe"> Coupe
                    </label>
                    <label class="block px-4 py-2">
                        <input type="checkbox" class="filter-categoria" id="wagon"> Wagon
                    </label>
                    
                </div>
            </div>
        </div>
    </div>

    <!-- Banner Promocional -->
    <div class="bg-gradient-to-r from-cyan-500 to-indigo-700 my-4 xl:mx-80 p-1">
        <img src="../assets/images/promo.png" alt="Promoción" class="w-full h-full object-cover border-spacing-96 border-blue-500">
    </div>

    <!-- Mosaico de Vehículos -->
    <div class="mx-auto max-w-7xl px-4 py-6 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6" id="vehicles-container">
        <!-- Vehículos serán agregados aquí dinámicamente -->
    </div>

    <!-- Footer -->
    <div id="footer-placeholder"></div>

</body>
</html>

<script>
    // Función para manejar los submenús desplegables
    function toggleMenu(id) {
        document.querySelectorAll('.dropdown-menu').forEach(menu => {
            if (menu.id === id) {
                menu.classList.toggle('hidden');
            } else {
                menu.classList.add('hidden');
            }
        });
    }

 // Función para manejar la selección de filtros
 function applyFilters(vehicles, reservedVehicleIds) {
    const selectedTransmision = Array.from(document.querySelectorAll('.filter-transmision:checked')).map(el => el.id);
    const selectedDisponibilidad = Array.from(document.querySelectorAll('.filter-disponibilidad:checked')).map(el => el.id);
    const selectedFabricante = Array.from(document.querySelectorAll('.filter-fabricante:checked')).map(el => el.id);
    const selectedCategoria = Array.from(document.querySelectorAll('.filter-categoria:checked')).map(el => el.id);

    return vehicles.filter(vehicle => {
        // Comprobar la transmisión
        const matchesTransmision = selectedTransmision.length === 0 || selectedTransmision.includes(vehicle.transmission.toLowerCase());

        // Comprobar la disponibilidad
        let matchesDisponibilidad = false;
        if (selectedDisponibilidad.length === 0) {
            matchesDisponibilidad = true; // Si no hay filtros de disponibilidad seleccionados, todos los vehículos son válidos
        } else {
            if (selectedDisponibilidad.includes('disponible') && !reservedVehicleIds.includes(vehicle.id)) {
                matchesDisponibilidad = true; // Vehículo disponible si no está reservado
            } else if (selectedDisponibilidad.includes('proximamente') && reservedVehicleIds.includes(vehicle.id)) {
                matchesDisponibilidad = true; // Vehículo próximamente si está reservado
            }
        }

        // Comprobar el fabricante y la categoría
        const matchesFabricante = selectedFabricante.length === 0 || selectedFabricante.includes(vehicle.manufacturer.toLowerCase());
        const matchesCategoria = selectedCategoria.length === 0 || selectedCategoria.includes(vehicle.category.toLowerCase());

        return matchesTransmision && matchesDisponibilidad && matchesFabricante && matchesCategoria;
    });
}




document.addEventListener('DOMContentLoaded', async () => {
    const container = document.querySelector('#vehicles-container');

    try {
        const vehiclesResponse = await fetch('http://localhost:3000/api/vehicles');
        const vehicles = await vehiclesResponse.json();

        // Obtener los vehículos reservados
        const availabilityResponse = await fetch('http://localhost:3000/api/vehicle-availability');
        const reservedVehicleIds = await availabilityResponse.json();

        // Función para mostrar los vehículos
        function showVehicles(vehiclesToDisplay) {
            container.innerHTML = vehiclesToDisplay.map(vehicle => `
                <a href="vehicle.html?id=${vehicle.id}" class="bg-gradient-to-r from-rose-400 to-purple-400 rounded-lg p-4 text-center relative">
                    ${reservedVehicleIds.includes(vehicle.id) ? 
                        '<div class="absolute top-2 right-2 bg-red-500 text-white px-2 py-1 text-xs rounded z-10">Proximamente</div>' : 
                        ''
                    }
                    <img src="${vehicle.image_url}" alt="${vehicle.name}" class="h-32 w-full object-cover rounded ${reservedVehicleIds.includes(vehicle.id) ? 'opacity-60' : ''}">
                    <p class="mt-2 text-white font-semibold">${vehicle.name}</p>
                </a>
            `).join('');
        }

        // Inicialmente mostrar todos los vehículos
        showVehicles(vehicles);

        // Añadir un event listener para cada filtro
        document.querySelectorAll('.filter-transmision, .filter-disponibilidad, .filter-fabricante, .filter-categoria').forEach(filter => {
            filter.addEventListener('change', () => {
                const filteredVehicles = applyFilters(vehicles, reservedVehicleIds);
                showVehicles(filteredVehicles);
            });
        });

    } catch (error) {
        console.error('Error al cargar los vehículos o reservas:', error);
        container.innerHTML = `<p class="text-red-500">Error al cargar los vehículos o reservas. Intenta nuevamente más tarde.</p>`;
    }
});

</script>


<script>
    // Cargar el contenido del archivo navbar.html dinámicamente
    document.addEventListener('DOMContentLoaded', async () => {
        try {
            const response = await fetch('../components/navbar.html');
            if (!response.ok) throw new Error('No se pudo cargar el navbar');
            const navbarHTML = await response.text();
            document.getElementById('navbar-placeholder').innerHTML = navbarHTML;
        } catch (error) {
            console.error('Error al cargar el navbar:', error);
        }
    });
</script>

<script>
    // Cargar el contenido del archivo footer.html dinámicamente
    document.addEventListener('DOMContentLoaded', async () => {
        try {
            const response = await fetch('../components/footer.html');  // Ruta del footer
            if (!response.ok) throw new Error('No se pudo cargar el footer.');

            const footerContent = await response.text();  // Obtener el contenido del footer
            document.getElementById('footer-placeholder').innerHTML = footerContent;  // Insertar el footer
        } catch (error) {
            console.error('Error al cargar el footer:', error);
        }
    });
</script>
